"use strict";window.bridges={},window.primaryTool=null,window.addEventListener("load",function(){makeAutosizeTextareas(),makeColorpickers(),makeWrappingExamples(),makePrimaryTool(),chainPrimaryTool()});function getChainData(a){for(var e=function(r){var o={},s=r.sides.getAttribute("data-override-options");s&&(o=JSON.parse(s));var d=[],v=r.options.get(),w=Object.keys(v);if(w.length)for(var m=0;m<w.length;m++){var L=w[m];if(o[L]===void 0){var E=v[L];d.push(encodeURIComponent(L)+"="+encodeURIComponent(E))}}return d},t=function(r){var o=r.sides.getAttribute("data-tool-url")||"",s=e(r);return s.length==0?o:o+encodeURIComponent("?"+s.join("&"))},n=[],i=a;i.chainChild;)i=i.chainChild,n.push(t(i));return n}function chainPrimaryTool(){var a=getURLQuery("chain");a&&chainToolWithArray(primaryTool,a.split(","),function(e){})}function removeChainedTools(a){for(var e=document.querySelector(".all-tools-container"),t=a.sides.querySelector(".side.output .side-widgets .widget-chain"),n=e.querySelector(".tool-chained:last-child");n&&n.tool!=a;)n.tool.chainParent.removeChain(),n.tool.destroy(),n=e.querySelector(".tool-chained:last-child");t.classList.remove("is-disabled"),t.textContent="Chain with...",a.sides.classList.remove("is-chained"),zenscroll.intoView(a.sides,400)}function chainToolWithArray(a,e,t){for(var n=document.querySelectorAll(".all-tools-container .tool"),i=a,r=null,o=0,s=0;o<e.length;o++,s++){r=e[o];var d=r.split(encodeURIComponent("?")),v=d[0],w={},m=d[1];if(m){m=decodeURIComponent(m).split("&");for(var L=0;L<m.length;L++){var E=m[L].split("="),C=decodeURIComponent(E[0]),q=decodeURIComponent(E[1]||"");(q=="true"||q=="yes"||q=="false"||q=="no")&&(q=q=="true"||q=="yes"),C&&(w[C]=q)}}var x=n[s+1];if(!x){i.output.showNegativeBadge('No tool with URL "{0}" was found'.format(v),"Last URL in your query might be invalid."),zenscroll.intoView(i.sides,400);break}if(v!=x.getAttribute("data-tool-url")){if(e[o+1])var I='"'+e[o+1].split(encodeURIComponent("?"))[0]+'"';else var I="next tool";i.output.showNegativeBadge('No tool with URL "{0}" was found'.format(v),"Chaining with {0} instead.".format(I)),s--;continue}var g=x.getAttribute("data-tool-bridge")||x.getAttribute("data-tool-url"),h=createTool(g,{sides:x,examples:null,chained:!0});if(!h){i.output.showNegativeBadge('Can\'t chain with "{0}"'.format(v),'Bridge "{0}" is not available.'.format(g)),zenscroll.intoView(i.sides,400);break}m&&h.options.set(w),i.attachChain(h),i.output.showStatus("chained!"),i.sides.classList.add("is-chained"),zenscroll.intoView(h.sides,400),makeAutosizeTextareas(),makeColorpickers(),i=h}t(i)}function chainToolWith(a,e,t){var n=a.sides,i=a.output,r=a.sides.querySelector(".side.output .side-widgets .widget-chain"),o=document.querySelector(".all-tools-container");r.classList.remove("is-disabled"),n.classList.remove("is-chained"),r.classList.add("is-disabled"),r.textContent="Chaining...",i.showStatus("chaining..."),i.hideBadge(),Site.GET("chain.json?tool="+e,function(s){var d=s.responseText;if(s.readyState==4&&s.status==200)try{var v=JSON.parse(d);i.showStatus("loading libraries...");var w={js:v.js,css:v.css};Site.resources.importFrom(w,function(){var m=document.createElement("div");m.innerHTML=v.html;var L=m.firstChild;o.insertBefore(L,a.sides.nextSibling);var E=createTool(v.call,{sides:L,examples:null,chained:!0});a.attachChain(E),i.showStatus("chained!"),r.textContent="Chained!",n.classList.add("is-chained"),i.hideBadge(),zenscroll.intoView(E.sides,400),makeAutosizeTextareas(),makeColorpickers(),typeof t=="function"&&t(E)})}catch(m){console.log(m),i.showNegativeBadge("Server error","Something has gone wrong while chaining the tool.",-1),r.classList.remove("is-disabled"),r.textContent="Retry chain?"}else s.readyState==4&&(i.showNegativeBadge("Server error","We can't chain this tool due to a server error.",-1),r.classList.remove("is-disabled"),r.textContent="Retry chain?")})}function makePrimaryTool(){var a=document.querySelector(".all-tools-container .tool-primary"),e=a.getAttribute("data-tool-bridge")||a.getAttribute("data-tool-url");primaryTool=createTool(e,{sides:a,examples:document.querySelector(".examples-primary"),chained:!1})}function createTool(a,e){var t=window.bridges[a]!==void 0?window.bridges[a]():!1,n=null;if(!t)return window.raise('Fatal error: Bridge "{0}" is not available.'.format(a)),n;var i=t.config,r=Object.keys(i).length==0;if(r?n=new TextTool(t.converter,null,e):i.type=="text"?n=new TextTool(t.converter,i,e):i.type=="image"?n=new ImageTool(t.converter,i,e):i.type=="file"&&(n=new FileTool(t.converter,i,e)),!r){var o=i.override;for(var s in o)n.override(s).with(o[s])}return n.start()}function TextTool(a,e,t){var n=new Tool({converter:a,sides:t.sides,examples:t.examples,chained:t.chained});return n}function FileTool(a,e,t){var n=new Tool({converter:a,sides:t.sides,examples:t.examples,chained:t.chained});function i(g,h){g.indexOf("http:")!==0&&g.indexOf("https:")!==0&&g.indexOf("ftp:")!==0&&g.indexOf("/")!==0&&(g="http://"+g);var b=new XMLHttpRequest;b.onreadystatechange=function(){this.readyState==4&&this.status==200?h(this.response):this.readyState==4&&this.status==0&&i("/get-external-file?url="+encodeURIComponent(g),h)},b.open("GET",g,!0),b.responseType="blob",b.send()}var r=null,o=null;function s(g){r.dataset.multitypeMode=g,n.input.currentMode=g,w()}function d(){return r.dataset.multitypeAllowText=="true"}function v(){return r.dataset.multitypeMode}function w(){console.log("Updating file info...")}function m(g){g instanceof Blob?(this.input.blob=g,s("file")):(o.value=g,s("text"))}function L(){var g=v();if(g=="text")return o.value;if(g=="file")return this.input.blob}function E(g){var h=this;h.input.showStatus("importing...");var b=g.target.files[0];b?(h.input.setValue(b),h.input.showStatus("imported"),h.convert(Trigger.IMPORT)):h.input.showWarningBadge("Can't import","No file was selected.",-1)}function C(){var g=this,h=g.input.getValue();if(!h){g.input.showStatus("nothing to save");return}if(h instanceof Blob)saveAs(h,"input-"+g.siteName+".bin");else{var b=new Blob([h],{type:"text/plain;charset=utf-8"});saveAs(b,"input-"+g.siteName+".txt")}}function q(){var g=this,h=v();if(h=="text"){o.select();var b=!1;try{b=document.execCommand("copy")}catch(O){}b?g.input.showStatus("copied"):g.input.showStatus("can't copy")}else g.input.showStatus("can't copy files (yet)")}function x(g){var h=this,b=g.querySelector(".input-sample");if(zenscroll?zenscroll.intoView(h.sides,400):window.scrollTo(0,h.sides),b.classList.contains("text-sample"))if(d()){var O=b.querySelector("span").textContent;h.input.setValue(O),h.options.set(h.options.get(g)),h.convert(Trigger.EXAMPLE)}else h.input.showWarningBadge("Unsupported example","This example uses text input, which is not supported by this tool.");else{var A=b.getAttribute("data-src");h.options.set(h.options.get(g)),h.input.showStatus("loading example..."),i(A,function(R){h.input.setValue(R),h.input.showStatus("imported"),h.convert(Trigger.EXAMPLE)})}}function I(g){var h=this,b=g.queryURL,O=g.queryInput||g.savedInput,A=g.then,R=function(u){var p=document.createElement("a");p.href=u;var c=p.hostname.split("."),f=c[c.length-1],y=c[c.length-2];return!y||!f?"url":y+"."+f};if(b){var l=R(b);h.input.showStatus("loading from {0}...".format(l)),i(b,function(u){h.input.setValue(u),h.input.showStatus("loaded from {0}".format(l)),h.convert(Trigger.IMPORT),A(!0)})}else d()&&O&&(h.input.showStatus("loading from input..."),h.input.setValue(O),h.input.showStatus("loaded from input"),h.convert(Trigger.RESTORE),A(!0));A()}return e.input&&(r=n.input.element.querySelector(".data-wrapper"),o=r.querySelector(".mode-text .data"),n.input.currentMode="file",n.input.blob=null,n.input.setValue=m.bind(n),n.input.getValue=L.bind(n),n.input.importFromFile=E.bind(n),n.input.download=C.bind(n),n.input.toClipboard=q.bind(n),n.setExample=x.bind(n),n.restore.input=I.bind(n)),n}function ImageTool(a,e,t){var n=new Tool({converter:a,sides:t.sides,examples:t.examples,chained:t.chained});function i(l,u){if(l.indexOf("data:")===0){for(var p=l.slice(5).split(";"),c=window.atob(p[1].split(",")[1]),f=[],y=0;y<c.length;y++)f.push(c.charCodeAt(y));u(new Blob([new Uint8Array(f)],{type:p[0]}))}else{l.indexOf("http:")!==0&&l.indexOf("https:")!==0&&l.indexOf("ftp:")!==0&&l.indexOf("/")!==0&&(l="http://"+l);var S=new XMLHttpRequest;S.onreadystatechange=function(){this.readyState==4&&this.status==200?u(this.response):this.readyState==4&&this.status==0&&i("/get-external-file?url="+encodeURIComponent(l),u)},S.open("GET",l,!0),S.responseType="blob",S.send()}}function r(l){var u=l.input.element.querySelector(".widget-load input[type=file]");u.value="",u.type="",u.type="file"}function o(l){var u=this;if(l===void 0){var p=u.output.element.querySelector(".data");p.toBlob(function(c){u.dispatchEvent("response",c)});return}u.dispatchEvent("response",l)}function s(){return this.input.blob}function d(){return this.output.blob}function v(l){this.output.blob=l}function w(l,u){var p=this;if(!l){u&&u();return}if(l instanceof Blob)try{p.input.blob=l;var c=document.createElement("img");c.onload=function(){var f=p.input.element.querySelector("canvas.data"),y=p.input.element.querySelector(".side-box");y.classList.remove("empty"),f.width=c.naturalWidth,f.height=c.naturalHeight,L(p),f.getContext("2d").drawImage(c,0,0),URL.revokeObjectURL(c.src),r(p),u&&u()},c.src=URL.createObjectURL(l)}catch(f){}else typeof l=="string"&&i(l,function(f){w.call(p,f,u)})}function m(l,u){u||(u=Trigger.IMPORT);var p=this;p.input.setValue(l,function(){p.input.showStatus("imported"),R.classList.remove("importing"),p.convert(u)})}function L(l){for(var u=[l.input.element.querySelector("canvas.data"),l.output.element?l.output.element.querySelector("canvas.data"):null,l.input.element.querySelector("canvas.preview"),l.output.element?l.output.element.querySelector("canvas.preview"):null],p=0;p<u.length;p++)u[p]&&(u[p].classList.add("not-empty"),u[p].style.transform="",u[p].removeAttribute("data-scroll-x"),u[p].removeAttribute("data-scroll-y"))}function E(l){var u=this,p=l.querySelector(".input-sample"),c=p.getAttribute("data-src");zenscroll?zenscroll.intoView(u.sides,400):window.scrollTo(0,u.sides),u.options.set(u.options.get(l)),u.input.showStatus("loading example..."),i(c,function(f){m.call(u,f,Trigger.EXAMPLE)})}function C(l,u){var p=this,c={png:"image/png",jpg:"image/jpeg",bmp:"image/jpeg",gif:"image/gif"};if(p[l].element)if(typeof u=="function"&&(u=u.call(p)),l=="input"){var f=p.input.blob;f?saveAs(f,l+"-"+p.siteName+"."+u):p.input.showStatus("nothing to save")}else{var y=p[l].element.querySelector(".data");y.toBlob(function(S){saveAs(S,l+"-"+p.siteName+"."+u)},c[u])}}function q(l){var u=this;u[l].showStatus("can't copy images (yet)")}function x(l){var u=this;l.preventDefault();var p=u.input.element.querySelector(".side-box");p.classList.remove("dragging"),u.input.showStatus("")}function I(l){var u=this;l.preventDefault(),u.input.showStatus("drop file to import!");var p=u.input.element.querySelector(".side-box");return p.classList.contains("dragging")||p.classList.add("dragging"),!1}function g(l){var u=this,p=u.input.element.querySelector(".side-box");p.classList.remove("dragging");var c=l.dataTransfer;if(c.items)for(var f=0;f<c.items.length;f++)c.items.remove(f);else l.dataTransfer.clearData()}function h(l,u){u.preventDefault();var p=this,c=p.input.element.querySelector(".side-box");c.classList.remove("dragging"),c.classList.add("importing"),p.input.showStatus("importing...");for(var f=u.dataTransfer.files,y=l=="*",S=0;S<f.length;S++){var T=f[S];if(y||T.type.indexOf(l)!==-1)m.call(p,T,Trigger.IMPORT);else{var B=T.type?'"'+T.type+'"':"This";p.input.showWarningBadge("Can't import",B+" format is not allowed.",-1)}}return c.classList.remove("importing"),c.classList.remove("dragging"),!1}function b(l,u){var p=this;p.input.showStatus("importing...");var c=(u.clipboardData||u.originalEvent.clipboardData).items,f=l=="*";for(var y in c){var S=c[y];if(S.kind==="file"){var T=S.getAsFile();if(f||T.type.indexOf(l)!==-1)m.call(p,T,Trigger.IMPORT);else{var B=T.type?'"'+T.type+'"':"This";p.input.showWarningBadge("Can't import",B+" format is not allowed.",-1)}}}}function O(l){var u=l.then;if(l.hasInput){var p=function(f){var y=document.createElement("a");y.href=f;var S=y.hostname.split("."),T=S[S.length-1],B=S[S.length-2];return!B||!T?"url":B+"."+T},c=l.queryURL||l.queryInput||l.savedInput;l.showStatus("loading from url..."),n.input.setValue(c,u)}else u()}function A(l){var u=this;u.input.showStatus("importing...");var p=l.target.files[0];p?m.call(u,p,Trigger.IMPORT):u.input.showWarningBadge("Can't import","No file was selected.",-1)}if(e.input){if(e.input.import=="base64"&&(n.input.importFromFile=A.bind(n)),e.parseImage===!1?n.parseImage=!1:n.parseImage=!0,e.input.image==!0){n.setExample=E.bind(n),document.addEventListener("paste",b.bind(n,"image/"));var R=n.input.element.querySelector(".side-box");R.addEventListener("dragover",I.bind(n),!1),R.addEventListener("dragend",g.bind(n),!1),R.addEventListener("dragleave",x.bind(n),!1),R.addEventListener("drop",h.bind(n,"image/"),!1),R.querySelector(".preview").addEventListener("click",function(){var l=n.input.element.querySelector(".side-box").classList.contains("empty");l&&n.input.element.querySelector(".widget-load").click()}),n.input.setValue=w.bind(n),n.input.getValue=s.bind(n),n.restore.input=O.bind(n)}e.input.download&&(n.input.download=C.bind(n,"input",e.input.download)),e.input.noClipboard&&(n.input.toClipboard=q.bind(n,"input"))}return e.output&&(e.output.download&&(n.output.download=C.bind(n,"output",e.output.download)),e.output.noClipboard&&(n.output.toClipboard=q.bind(n,"output")),n.output.setValue=v.bind(n),n.output.getValue=d.bind(n),n.respond=o.bind(n)),n}function Tool(a){var e=this;e.sides=a.sides,e.input={getValue:function(){if(!e.input.element)return"";var t=e.input.element.querySelector("textarea.data");return t?t.value:""},setValue:function(t){if(!e.input.element)return"";var n=e.input.element.querySelector("textarea.data");if(n)return n.value=t,e.save(),n.value},showStatus:function(t){var n=e.input.element;return e.showStatus(n,t)},showPositiveBadge:function(t,n){var i=e.input.element;return e.showBadge(i,"positive",t,n)},showNegativeBadge:function(t,n){var i=e.input.element;return e.showBadge(i,"negative",t,n)},showWarningBadge:function(t,n){var i=e.input.element;return e.showBadge(i,"warning",t,n)},hideBadge:function(){var t=e.input.element;return e.hideAllBadges(t)},importFromFile:function(t){e.input.showStatus("importing...");var n=t.target.files[0];if(n){var i=new FileReader;i.onload=function(r){var o=i.result;e.input.setValue(o),e.convert(Trigger.IMPORT),e.input.showPositiveBadge("Import successful!",n.name+" ("+sizeToString(n.size)+") imported as plain text.",-1)},i.readAsText(n)}else e.input.showWarningBadge("Can't import","No file was selected.",-1)},download:function(){var t=new Blob([e.input.getValue()],{type:"text/plain;charset=utf-8"});saveAs(t,"input-"+e.siteName+".txt")},toClipboard:function(){return e.toClipboard(e.input)},showWidgetToggle:function(t){e.dispatchEvent("widgetshow",{side:"input",name:t,cause:"function"})},hideWidgetToggle:function(){e.dispatchEvent("widgethide",{side:"input",cause:"function"})},element:null},e.output={getValue:function(){if(!e.output.element)return"";var t=e.output.element.querySelector("textarea.data");return t?t.value:""},setValue:function(t){if(!e.output.element)return"";var n=e.output.element.querySelector("textarea.data");return n?n.value=t:""},showError:function(t){e.output.hideError(),e.output.hideBadge(),e.output.element.classList.add("error"),e.output.showNegativeBadge("Can't convert.","An error has occurred."),e.output.showStatus("error"),e.output.setValue("Error: {0}".format(t||"(not specified)"))},hideError:function(){e.output.hideBadge(),e.output.element.classList.remove("error")},showPositiveBadge:function(t,n){var i=e.output.element;e.showBadge(i,"positive",t,n)},showNegativeBadge:function(t,n){var i=e.output.element;e.showBadge(i,"negative",t,n)},showWarningBadge:function(t,n){var i=e.output.element;e.showBadge(i,"warning",t,n)},hideBadge:function(){var t=e.output.element;e.hideAllBadges(t)},download:function(){var t=new Blob([e.output.getValue()],{type:"text/plain;charset=utf-8"});saveAs(t,"output-"+e.siteName+".txt")},toClipboard:function(){return e.toClipboard(e.output)},showStatus:function(t){var n=e.output.element;return e.showStatus(n,t)},showWidgetToggle:function(t){e.dispatchEvent("widgetshow",{side:"output",name:t,cause:"function"})},hideWidgetToggle:function(){e.dispatchEvent("widgethide",{side:"output",cause:"function"})},element:null},e.save=function(){if(!!e.isPrimary){if(typeof Storage=="undefined")return e.warn("error:save","local storage not supported"),!1;var t=e.input.element?e.input.element.querySelector(".data"):!1,n=e.options.element,i=window.localStorage||null;if(i&&i.setItem("autosave_origin",window.location.pathname),t&&t.getAttribute("data-autosave")!==null){var r=i.autosave_input,o=e.input.getValue();r!==o&&(i&&i.setItem("autosave_input",o),e.input.showStatus("saved"))}if(n&&n.getAttribute("data-autosave")!==null){var r=i.autosave_options||{},o=JSON.stringify(e.options.get());isEquivalent(r,o)||i&&i.setItem("autosave_options",o)}}},e.restore={input:function(t){var n=t.then;if(t.hasInput){var i=function(s){var d=document.createElement("a");d.href=s;var v=d.hostname.split("."),w=v[v.length-1],m=v[v.length-2];return!m||!w?"url":m+"."+w},r=function(s){var d=e.input.setValue;d.length==2?d(s,n.bind(null,!0)):d.length==1&&(d(s),n(!0))},o=function(s,d){s.indexOf("http:")!==0&&s.indexOf("https:")!==0&&s.indexOf("ftp:")!==0&&s.indexOf("/")!==0&&(s="http://"+s);var v=new XMLHttpRequest;v.onreadystatechange=function(){this.readyState==4&&this.status==200?d(this.responseText):this.readyState==4&&this.status==0&&o("/get-external-file?url="+encodeURIComponent(s),d)},v.open("GET",s,!0),v.responseType="text",v.send()};t.queryURL?(t.showStatus("loading from {0}...".format(i(t.queryURL))),o(t.queryURL,r)):(t.showStatus("loading from input..."),r(t.queryInput||t.savedInput))}else n()},options:function(t){var n=t.then;if(t.hasOptions){t.savedOptions&&e.options.set(t.savedOptions);var i=e.options.get(),r={};for(var o in t.fullQuery){var s=t.fullQuery[o]!==void 0,d=i[o]!==void 0;s&&d&&(r[o]=t.fullQuery[o])}var v=Object.keys(r).length>0;v&&e.options.set(r),n(v)}else n(!1)},all:function(){if(!!e.isPrimary){var t=window.localStorage||{},n=t.autosave_origin&&window.location.pathname!==t.autosave_origin;n&&(t.autosave_input="",t.autosave_options="{}");var i=getURLQuery(),r=t.autosave_input||"",o=JSON.parse(t.autosave_options||"{}"),s=i.input,d=i["input-url"];e.restore.input({savedInput:r,queryInput:s,showStatus:e.input.showStatus,hasInput:!!e.input.element,queryURL:d,then:function(){e.restore.options({savedOptions:o,hasOptions:!!e.options.element,fullQuery:i,then:function(v){e.convert(Trigger.RESTORE),s===null&&e.input.showWarningBadge("Can't load input from query","The ?input parameter is malformed."),d===null&&e.input.showWarningBadge("Can't load input from URL","The ?input-url parameter is malformed.")}})}})}}},e.swap=function(t){if(e.input.element&&e.output.element){var n=e.input.getValue()||"",i=e.output.getValue()||"",r=e.input.element.querySelector("label"),o=e.output.element.querySelector("label");if(!r.style.left){var s=Math.abs(o.getBoundingClientRect().left-r.getBoundingClientRect().left);if(r.style.left=s+"px",o.style.left=-1*s+"px",e.input.setValue(i),e.output.setValue(n),typeof Storage!="undefined"){var d=window.localStorage;d.setItem("autosave_origin","/"+t),d.setItem("autosave_input",i)}setTimeout(function(){window.location.assign("/"+t)},100)}}},e.trigger=null,e.resetErrorsOnConvert=!0,e.respond=function(t){t===void 0&&(t=e.output.getValue()),e.dispatchEvent("response",t)},e.events={response:[],optionchange:[],widgetshow:[],widgethide:[]},e.dispatchEvent=function(t,n){if(Object.keys(e.events).indexOf(t)===-1)throw'Event "'+t+'" is not supported';for(var i=e.events[t],r=0;r<i.length;r++){var o=i[r].handler.call(e,n);if(i[r].once&&e.events[t].splice(r,1),o===!1)break}},e.removeEventListener=function(t,n){if(Object.keys(e.events).indexOf(t)===-1)throw'Event "'+t+'" is not supported';if(typeof n=="undefined")throw"Listener note is not specified";for(var i=e.events[t],r=0;r<i.length;r++)i[r].note==n&&e.events[t].splice(r,1)},e.addEventListener=function(t){typeof t!="object"&&(t={});var n=t.event||"undefined",i=t.handler||!1;if(!i)throw"Event handler is not specified";if(Object.keys(e.events).indexOf(n)===-1)throw'Event "'+n+'" is not supported';e.events[n].push({handler:i,note:t.note||void 0,once:t.once||!1})},e.isPrimary=!a.chained,e.chainParent=null,e.chainChild=null,e.getCompatibility=function(){var t=e.sides,n=t.getAttribute("data-accepts")||!1,i=t.getAttribute("data-returns")||!1;return{accepts:n,returns:i}},e.attachChain=function(t){e.chainChild=t,t.chainParent=e,e.addEventListener({event:"response",note:"chain",handler:function(r){var o=t.input.setValue;e.log({type:"chain propagate",from:e,to:t,data:r}),o.length==2?o(r,function(){t.convert(Trigger.CHAIN)}):o.length==1&&(o(r),t.convert(Trigger.CHAIN))}});var n=e.output.getValue();if(n){e.log({type:"chain connect",from:e,to:t,data:n});var i=t.input.setValue;i.length==2?i(n,function(){t.convert(Trigger.CHAIN)}):i.length==1&&(i(n),t.convert(Trigger.CHAIN))}},e.removeChain=function(){e.chainChild.chainParent=null,e.chainChild=null,e.removeEventListener("response","chain")},e.convert=function(t){var n=!!e.input.element,i=!!e.output.element;if(e.trigger=null,t&&(e.trigger=t),e.log({type:"conversion",trigger:t}),n&&i){e.resetErrorsOnConvert&&(e.output.hideError(),e.input.hideBadge());var r=e.input.getValue();try{var o=e.converter(r);o!==void 0&&e.dispatchEvent("response",o)}catch(s){window.raise("<b>Conversion error:</b> "+s.toString()),console.error(s),r?(e.warn("error:converting",s.toString()),e.output.showError(s)):e.output.setValue("")}}else if(n&&!i){e.resetErrorsOnConvert&&e.input.hideBadge();try{var r=e.input.getValue();e.converter(r)}catch(s){window.raise("<b>Conversion error:</b> "+s.toString()),console.error(s),r?(e.warn("error:converting",s.toString()),e.input.showNegativeBadge("Error has occured",s,-1)):e.output.setValue("")}}else if(!n&&i){e.resetErrorsOnConvert&&e.output.hideError();try{var o=e.converter();o!==void 0&&e.dispatchEvent("response",o)}catch(s){window.raise("<b>Conversion error:</b> "+s.toString()),console.error(s),e.warn("error:converting",s.toString()),e.output.showError(s)}}e.save()},e.converter=function(){},e.options={default:null,get:function(t){var n=e.sides.getAttribute("data-override-options");if(t||(t=e.options.element),!t)return n?JSON.parse(n):{};var i=t.getAttribute("data-resets-all-options")!==null;i&&e.options.reset();for(var r=t.querySelectorAll(".input-option"),o={},s=0;s<r.length;s++){var d=r[s],v=d.getAttribute("data-index"),w=null,m=d.tagName.toLowerCase();d.type=="checkbox"||d.type=="radio"?w=d.checked:(d.type=="text"||m=="textarea"||m=="select")&&(w=d.value),o[v]=w}if(n){var L=JSON.parse(n);for(var E in L)o[E]=L[E]}return o},set:function(t){var n=e.options.element;if(n)for(var i=n.querySelectorAll(".input-option"),r=0;r<i.length;r++){var o=i[r],s=o.getAttribute("data-index");if(typeof t[s]!="undefined"){var d=t[s],v=o.tagName.toLowerCase();o.type=="checkbox"||o.type=="radio"?o.checked=d:(o.type=="text"||v=="textarea"||v=="select")&&(o.value=d),o.type=="textarea"&&autosize.update(o)}}return e.options.get()},reset:function(){e.options.set(e.options.default)},describe:function(t,n){var i=e.options.element;if(i){var r=i.querySelector('.option-detail-key[data-detail-key="'+t+'"]');r&&(r.innerText=n)}return e.options.get()},element:null},e.accidents=[],e.warn=function(t,n){var i={event:t,data:n};e.accidents.push(i),window.raise("<b>Tool warning:</b> ("+t.toString()+") "+n.toString(),"warning")},e.log=function(t){window.log(e,t)},e.init=function(){var t=e.sides,n=a.examples;e.input.element=t.querySelector(".side.input"),e.output.element=t.querySelector(".side.output"),e.options.element=t.querySelector(".converter-options");var i=e.options.element?e.options.element.querySelectorAll(".option-row .option-details"):null;if(i)for(var r=0;r<i.length;r++){var o=i[r];o.innerHTML=o.innerHTML.replace(/{([a-z0-9\-]+)}/ig,function(c,f){var y=document.createElement("span");return y.className="option-detail-key",y.setAttribute("data-detail-key",f),y.innerText="<"+f+">",y.outerHTML})}var s=t.querySelector(".tool-toggle-layout");s&&s.addEventListener("click",function(){t.classList.toggle("expanded"),setTimeout(function(){e.convert(Trigger.RESIZE)},100)});var d=t.querySelector(".sides-primary-button button");d&&d.addEventListener("click",function(){e.convert(Trigger.ACTION)});var v=t.querySelector(".tool-swap");v&&v.addEventListener("click",function(c){var f=v.getAttribute("data-swap-to");e.swap(f)});var w=t.querySelector(".tool-create-link"),m=t.querySelector(".sides-wrapper"),L=t.querySelector(".tweet-link-button");if(L&&L.addEventListener("click",function(){var c=this.getAttribute("data-tweet-url");window.open(c)}),w){var E=w.querySelector(".tool-link"),C=function(c){(!c||!E.contains(c.target))&&(!c||c.stopPropagation(),w.classList.remove("active"),m.classList.remove("muted"),document.removeEventListener("click",C))};w.addEventListener("click",function(c){if(!E.contains(c.target))if(w.classList.contains("active"))C();else{var f=E.querySelector("input"),y=window.location.origin+window.location.pathname+"?",S=[],T=e.options.get(),B={},k=e.sides.getAttribute("data-override-options");k&&(B=JSON.parse(k));var M=getChainData(e);if(M.length>0&&S.push("chain="+encodeURIComponent(M.join(","))),e.input.element){var j=typeof e.input.getValue()=="string",P=getURLQuery("input"),z=getURLQuery("input-url");z?S.push("input-url="+encodeURIComponent(z)):P?S.push("input="+encodeURIComponent(P)):j&&S.push("input="+encodeURIComponent(e.input.getValue()))}var V=Object.keys(T);if(V.length)for(var N=0;N<V.length;N++){var U=V[N];if(B[U]===void 0){var H=T[U];S.push(encodeURIComponent(U)+"="+encodeURIComponent(H))}}f.value=y+S.join("&"),c.stopPropagation(),w.classList.add("active"),m.classList.add("muted"),document.addEventListener("click",C),setTimeout(function(){f.select(),f.focus(),f.select()},201)}})}if(e.input.element){makeToggleableWidgets(e,"input"),e.input.element.addEventListener("keyup",function(){e.convert(Trigger.KEYPRESS)});var q=t.querySelector(".widget-load");q.addEventListener("click",function(){t.querySelector(".widget-load input").click()});var x=t.querySelector(".widget-load input");x.addEventListener("change",function(c){e.input.importFromFile(c)},!1);var I=t.querySelector(".input .widget-save-as");I.addEventListener("click",function(){e.input.showStatus("saving..."),e.input.download()});var g=t.querySelector(".input .widget-copy");g.addEventListener("click",function(){e.input.toClipboard()})}if(e.output.element){makeToggleableWidgets(e,"output"),e.addEventListener({event:"widgetshow",handler:function(c){if(c.name=="toggle-chain"){var f=t.querySelector(".output");populateChainCombinator(e,f)}}}),e.addEventListener({event:"widgetshow",handler:function(c){if(c.name=="toggle-remove-chain"){var f=getChainData(e).length;f==1?f+=" tool":f>1&&(f+=" tools");var y=t.querySelector(".output .toggle-remove-chain .remove-how-many");y.textContent=f}}}),e.addEventListener({event:"widgethide",handler:function(c){var f=t.querySelector(".output"),y=f.classList.contains("combinator-active");c.side=="output"&&y&&f.classList.remove("combinator-active")}});var h=t.querySelector(".output .toggle-remove-chain .remove-chain-yes");h.addEventListener("click",function(){removeChainedTools(e),e.output.hideWidgetToggle()});var b=t.querySelector(".output .toggle-chain .chain-search");b.addEventListener("keyup",function(){chainSearch(t)});var O=t.querySelector(".output .widget-copy");O.addEventListener("click",function(){e.output.toClipboard()});var A=t.querySelector(".output .widget-save-as");A.addEventListener("click",function(){e.output.showStatus("saving..."),e.output.download()})}if(e.globalHandlers.convertOnResize=e.globalHandlers.convertOnResize.bind(e),window.addEventListener("resize",e.globalHandlers.convertOnResize),n){var R=n.querySelectorAll(".card");if(R)for(var r=0;r<R.length;r++)(function(f){f.addEventListener("click",function(y){e.setExample.call(e,f)})})(R[r])}e.addEventListener({event:"optionchange",handler:e.convert.bind(e,Trigger.OPTIONS)});var l=t.querySelectorAll(".converter-options .input-option");if(l)for(var r=0;r<l.length;r++){var u=l[r];u.addEventListener("change",e.dispatchEvent.bind(e,"optionchange")),u.addEventListener("keyup",e.dispatchEvent.bind(e,"optionchange"))}e.addEventListener({event:"response",handler:function(c){e.log({type:"response self",data:c}),this.output.setValue(c)}}),e.addEventListener({event:"widgetshow",handler:function(c){showWidgetToggle(e,c.side,c.name)}}),e.addEventListener({event:"widgethide",handler:function(c){hideWidgetToggle(e,c.side)}}),t.tool=e,e.converter=a.converter,e.sides=t;var p=t.querySelector(".tool-favorite");p&&(p.addEventListener("click",e.favorite.bind(e)),e.favorite()),e.options.default=e.options.get()},e.override=function(t){t=t.split(".");for(var n=e,i=null,r=0;r<t.length;r++)if(i=t[r],n[i]!==void 0)r!=t.length-1&&(n=n[i]);else throw"tool."+t.splice(0,r).join(".")+" does not contain "+i;return{with:function(o){n[i]=o.bind(e)}}},e.destroy=function(){e.output.element=null,e.output.tool=null,e.input.element=null,e.input.tool=null,e.options.element=null,e.converter=null,e.sides.tool=null,e.sides.innerHTML=e.sides.innerHTML,e.sides.parentElement.removeChild(e.sides),e.sides=null;for(var t in e.events)e.events[t]=[];window.removeEventListener("resize",e.globalHandlers.convertOnResize),e=null},e.input.tool=e,e.output.tool=e,e.init(),e.start=function(){return e.restore.all(),e}}var Trigger=Object.freeze({OPTIONS:1,ACTION:2,KEYPRESS:3,RESIZE:4,RESTORE:5,EXAMPLE:6,IMPORT:7,CHAIN:8});Tool.prototype.globalHandlers={convertOnResize:function(){this.convert(Trigger.RESIZE)}},Tool.prototype.setExample=function(a){var e=this,t=a.querySelector(".text-sample.input-sample span"),n=t?t.textContent:"";e.input.setValue(n),e.options.set(e.options.get(a)),e.convert(Trigger.EXAMPLE),zenscroll?zenscroll.intoView(e.sides,400):window.scrollTo(0,e.sides)},Tool.prototype.favorite=function(a){var e=this;if(typeof Storage!="undefined"){var t=window.localStorage||null,n=JSON.parse(t&&t.favorite_tools||"[]"),i="/"+window.location.pathname.split("/")[1];if(a){var r=n.indexOf(i);r!==-1?n.splice(r,1):n.push(i)}t&&t.setItem("favorite_tools",JSON.stringify(n));var o=n.indexOf(i)!==-1,s=e.sides.querySelector(".tool-favorite");s.classList.remove("active"),o&&s.classList.add("active"),Site.sortAllTools()}},Tool.prototype.showBadge=function(a,e,t,n){if(this.hideAllBadges(a),a&&(e=="negative"||e=="positive"||e=="warning")){var i=5,r=a.querySelector(".badge .badge-title"),o=a.querySelector(".badge .badge-message");r.textContent=t,o.textContent=n,a.classList.add("badge-"+e);var s=a.querySelector(".badge").offsetHeight,d=a.querySelector(".data-wrapper");d&&(d.style.paddingTop=s+i+"px")}},Tool.prototype.siteName=function(){return/^local/.test(window.location.host)?window.location.host.split(".")[1]:window.location.host.split(".")[0]}(),Tool.prototype.hideAllBadges=function(a){if(!!a){var e=a.querySelector(".data-wrapper");e&&(e.style.paddingTop=""),a.classList.remove("badge-negative"),a.classList.remove("badge-positive"),a.classList.remove("badge-warning")}},Tool.prototype.showStatus=function(a,e){if(!!a){var t=1e3,n=a.querySelector("label .status"),i=Math.random();n.textContent=e,n.className="status active",n.setAttribute("animation-id",i),setTimeout(function(){i==n.getAttribute("animation-id")&&(n.classList.remove("active"),setTimeout(function(){n.textContent=""},200))},t)}},Tool.prototype.toClipboard=function(a){var e=a.element.querySelector(".data");e.select();try{var t=document.execCommand("copy");t?a.showStatus("copied"):a.showStatus("can't copy")}catch(n){}};function makeWrappingExamples(){window.addEventListener("resize",updateExamples),updateExamples()}function chainSearch(a){for(var e=a.querySelector(".side.output"),t=e.querySelector(".tool-combinator .combinator-tools"),n=t.querySelectorAll(".combinator-tool"),i=e.querySelector(".side-widgets .toggle-chain .chain-search"),r=function(m){return Site.removeStopWords(m.toLowerCase())},o=r(i.value),s=0;s<n.length;s++){var d=n[s],v=r(d.querySelector(".combinator-title").textContent),w=r(d.querySelector(".combinator-description").textContent);d.classList.remove("hidden"),v.indexOf(o)===-1&&w.indexOf(o)===-1&&(d.classList.add("hidden"),t.appendChild(d))}}function makeColorpickers(){Site.applyToAllElements(".input-option.color.active.not-initialized",function(a){a.classList.remove("not-initialized"),Colorpicker.create(a)})}function makeAutosizeTextareas(){Site.applyToAllElements("textarea.autosize.not-initialized",function(a){a.classList.remove("not-initialized"),autosize(a)})}function populateChainCombinator(a,e){var t=e.querySelector(".side-widgets-toggle .toggle-chain .widget-chain-search"),n=t.querySelector(".chain-search"),i=e.querySelector(".tool-combinator .combinator-list"),r=a.getCompatibility().returns||"nothing",o=250;t.classList.remove("state-wait"),t.classList.remove("state-search"),t.classList.remove("state-error"),t.classList.add("state-wait"),n.disabled=!0,n.value="",i.scrollTop=0,n.placeholder="Connecting to server...";var s="all-tools.json?accepts={0}".format(r);Site.GET(s,function(d){var v=d.responseText;if(d.readyState==4&&d.status==200)try{var w=JSON.parse(v);if(w.error||!w.json)t.classList.remove("state-wait"),t.classList.add("state-error"),n.placeholder="Tools unavailable.";else{n.placeholder="Loading all tools...";for(var m=i.querySelector(".combinator-tools");m.firstChild;)m.removeChild(m.firstChild);for(var L in w.json)for(var E=0;E<w.json[L].length;E++){var C=w.json[L][E],q=document.createElement("div");q.className="combinator-tool",q.setAttribute("data-url",C.url);var x=document.createElement("span");x.className="combinator-title",x.textContent=C.title;var I=document.createElement("span");I.className="combinator-description",I.textContent=C.desc,q.appendChild(x),q.appendChild(I),function(g){g.addEventListener("click",function(){chainToolWith(a,this.getAttribute("data-url")),a.output.hideWidgetToggle()})}(q),m.appendChild(q)}setTimeout(function(){t.classList.remove("state-wait"),t.classList.add("state-search"),n.disabled=!1,n.placeholder="Search all tools...",n.focus(),e.classList.remove("combinator-active"),e.classList.add("combinator-active")},o)}}catch(g){t.classList.remove("state-wait"),t.classList.add("state-error"),n.placeholder="Can't load."}else d.readyState==4&&(t.classList.remove("state-wait"),t.classList.add("state-error"),n.placeholder="Unexpected response.")})}function makeToggleableWidgets(a,e){for(var t=a[e].element.querySelector(".side-widgets"),n=t.querySelector(".side-widgets-wrapper"),i=t.querySelector(".side-widgets-toggle"),r=t.querySelectorAll(".widget"),o=0;o<r.length;o++)(function(d){d.addEventListener("click",function(){var v=d.getAttribute("data-toggle"),w=d.getAttribute("data-hides-toggle")!==null;v&&a.dispatchEvent("widgetshow",{side:e,cause:"click",name:v}),w&&a.dispatchEvent("widgethide",{side:e,cause:"click"})})})(r[o]);var s=i.querySelector(".toggle-hide");s.addEventListener("click",function(){a.dispatchEvent("widgethide",{cause:"close",side:e})}),window.addEventListener("keyup",function(d){var v=d.key.toLowerCase(),w=v=="esc"||v=="escape",m=t.classList.contains("toggled");w&&m&&a.dispatchEvent("widgethide",{cause:"esc",side:e})})}function hideWidgetToggle(a,e){var t=a[e].element;if(t){var n=t.querySelector(".side-widgets"),i=n.querySelector(".side-widgets-wrapper"),r=n.querySelector(".side-widgets-toggle");i.style.transform="rotateX(0deg) translateY(0px) translateZ(0px)",r.style.transform="rotateX(90deg) translateY(-50%) translateZ({0}px)".format(n.offsetHeight/2),n.classList.remove("toggled")}}function showWidgetToggle(a,e,t){var n=a[e].element;if(n){var i=n.querySelector(".side-widgets"),r=i.querySelector(".side-widgets-wrapper"),o=i.querySelector(".side-widgets-toggle");if(hideWidgetToggle(a,e),t){var s=o.querySelector("."+t);if(s){for(var d=i.querySelectorAll(".side-widgets-toggle .toggle-wrapper .widget-toggle"),v=0;v<d.length;v++)d[v].classList.remove("toggle-active");s.classList.add("toggle-active"),o.style.transform="rotateX(0deg) translateY(0px) translateZ(0px)",r.style.transform="rotateX(-90deg) translateY(50%) translateZ({0}px)".format(i.offsetHeight/2),i.classList.remove("toggled"),i.classList.add("toggled")}else window.raise("Widget tried to toggle section .{0}, but it does not exists.".format(t))}}}function updateExamples(){for(var a=document.querySelectorAll(".examples .wrapper"),e=0;e<a.length;e++){var t=a[e],n=t.querySelector(".sample");if(!n.querySelector(".file-sample")){n.classList.remove("big");var i=5,r=t.getBoundingClientRect().width,o=n.scrollWidth;o>=r-i&&n.classList.add("big")}}}function buildURLQuery(a){var e=[];for(var t in a){var n=a[t];e.push(encodeURIComponent(t)+(n?"="+encodeURIComponent(n):""))}return"?"+e.join("&")}function getURLQuery(a){for(var e=window.location.search.substring(1).split("&"),t={},n=0;n<e.length;n++){var i=e[n].split("=");try{var r=decodeURIComponent(i[0])}catch(s){continue}try{var o=decodeURIComponent(i[1]||"")}catch(s){var o=null}(o=="true"||o=="yes"||o=="false"||o=="no")&&(o=o=="true"||o=="yes"),r&&(t[r]=o)}return a?t[a]:t}function isEquivalent(a,e){if(typeof a!="object"||typeof e!="object")return!1;var t=Object.getOwnPropertyNames(a),n=Object.getOwnPropertyNames(e);if(t.length!=n.length)return!1;for(var i=0;i<t.length;i++){var r=t[i];if(a[r]!==e[r])return!1}return!0}function sizeToString(a,e){if(a==0)return"empty";var t=1024,n=e||2,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,r)).toFixed(n))+i[r]}
